{%- liquid
  assign isModal = false
  if template == 'product.modal'
    assign isModal = true
  endif

 
-%}
 
{% render 'product-zoom-js' %}

{% if product.handle == 'neuromd-back-pain-relief-device-50-off' %}
<script>
  if (localStorage.getItem('visitedQuiz') === 'true') {
    window.location.href = 'https://getneuromd.com/products/neuromd-corrective-therapy-device/';
  }
</script> 
{% endif %}

<div class="prodMain" style="background-color:{{ section.settings.backgroundColor }};">
  <div class="prodMain__inner">
    <div class="prodMain__left testp1">
       
      <div class="prodMain__upperSlider">
        {% comment %}
        {% for image in product.images %}
          <!-- zoom_image-container -->
          <div class="prodMain__upperSlideWrapper ">
            <img class="prodMain__upperSlide lazyload"
            data-src="{{ image.src | product_img_url: '1160x' }}"
            alt="{{ image.alt }}">
      
       
          </div>
        {% endfor %}
        {% endcomment %}
        {% for image in product.images %}
  <div class="prodMain__upperSlideWrapper">
    <img class="prodMain__upperSlide toZoom lazyload"
         data-src="{{ image.src | product_img_url: '1160x' }}"
         alt="{{ image.alt }}">
  </div>
{% endfor %}

<!-- Modal Container -->
<div id="idMyModal" class="modal" style="display:none;">
  <span class="close">&times;</span>
  <img class="modal-content" id="modalImg">
</div>
        {% if section.settings.videoThumb != '' and section.settings.videoIframe != '' %}
          <div class="prodMain__upperSlideWrapper" vidRef='{{ section.settings.videoIframe }}'>
            <img class="prodMain__upperSlide lazyload"
            data-src="{{ section.settings.videoThumb | img_url: '1160x' }}"
            alt="{{ section.settings.videoThumb.alt }}">
            <div class="prodBlade__vid">
                <button class="prodBlade__videoButton__big" vidRef='{{ section.settings.videoIframe }}'>
                  <img class="prodBlade__playImg lazyload"
                  data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/Fill_1_Copy_7.png?v=1595619340"
                  alt="play button">
                  <span class="prodBlade__vidText text--15 text--white">
                    Watch Video
                  </span>
                </button>
              </div>
          </div>
          {% endif %}
      </div>
      <div class="prodMain__lowerSlider">
        {% for image in product.images %}
          <div class="prodMain__lowerSlideWrapper">
            <img class="prodMain__lowerSlide lazyload"
            data-src="{{ image.src | product_img_url: '200x' }}"
            alt="{{ image.alt }}">
          </div>
        {% endfor %}
         {% if section.settings.videoThumb and section.settings.videoIframe != '' %}
          <div class="prodMain__lowerSlideWrapper" vidRef='{{ section.settings.videoIframe }}'>
            <img class="prodMain__upperSlide lazyload"
            data-src="{{ section.settings.videoThumb | img_url: '200x' }}"
            alt="{{ section.settings.videoThumb.alt }}">
            <div class="prodBlade__vid">
                <button class="prodBlade__videoButton__sm" vidRef='{{ section.settings.videoIframe }}'>
                  <img class="prodBlade__playImg lazyload"
                  data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/Fill_1_Copy_7.png?v=1595619340"
                  alt="play button">
                  <!-- <span class="prodBlade__vidText text--15 text--white">
                    Watch Video
                  </span> -->
                </button>
              </div>
          </div>
        {% endif %}
      </div>
    </div>
    <div class="prodMain__right">
      <div class="prodMain__text">
        <h1 class="prodMain__title text--28 text--com text--blue">
          {{ product.title }}
        </h1>
        {% comment %}
        <a class="prodMainRev__stars mobileStars" href="#shopify-section-prod-reviews">
                <img class="prodMainRev__star lazyload"
                data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/star.png?v=1595616774"
                alt="Star">
                <img class="prodMainRev__star lazyload"
                data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/star.png?v=1595616774"
                alt="Star">
                <img class="prodMainRev__star lazyload"
                data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/star.png?v=1595616774"
                alt="Star">
                <img class="prodMainRev__star lazyload"
                data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/star.png?v=1595616774"
                alt="Star">
                <img class="prodMainRev__star lazyload"
                data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/star.png?v=1595616774"
                alt="Star">
                <span class="prodMainRev__count text--16 text--gray">
                   (Loading...)
                </span>
        </a>
        {% endcomment %}
        <div class="mobileStars">
          {% render 'judgeme_widgets', widget_type: 'judgeme_preview_badge', jm_style: '', concierge_install: false, product: product %}
        </div>
        <div class="prodMain__description text--15">
          {{ section.settings.productDescription }}
        </div>
        {% if section.settings.reviewTitle != '' %}
          <div class="prodMainRev">
            <div class="prodMainRev__headRow">
              <div class="prodMainRev__title text--15">
                {{ section.settings.reviewTitle }} 
              </div>
              {% comment %}
              <a class="prodMainRev__stars"  href="#shopify-section-prod-reviews">
                <img class="prodMainRev__star lazyload"
                data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/star.png?v=1595616774"
                alt="Star">
                <img class="prodMainRev__star lazyload"
                data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/star.png?v=1595616774"
                alt="Star">
                <img class="prodMainRev__star lazyload"
                data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/star.png?v=1595616774"
                alt="Star">
                <img class="prodMainRev__star lazyload"
                data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/star.png?v=1595616774"
                alt="Star">
                <img class="prodMainRev__star lazyload"
                data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/star.png?v=1595616774"
                alt="Star">
                <span class="prodMainRev__count text--16 text--gray">
                  (Loading...)
                </span>
              </a>
              {% endcomment %}
              {% render 'judgeme_widgets', widget_type: 'judgeme_preview_badge', jm_style: '', concierge_install: false, product: product %}
            </div>
            <div class="prodMainRev__text text--15">
              {{ section.settings.reviewText }}
            </div>
            <div class="prodMainRev__name text--15">
              â€“ {{ section.settings.reviewName }}
            </div>
          </div>
        {% endif %}
        <div class="prodMain__priceRow">
          <div class="prodMain__price text--18" id="price">
            {{ product.price | money }}
          </div>
          <div class="prodMain__comparePrice text--15 text--gray" id="compare">
           <s> {{ product.compare_at_price | money }}</s>&nbsp;{% if section.settings.priceSavings != '' %}({{ section.settings.priceSavings }}){% endif %}
          </div>
        </div>
        {%- comment -%}
        START: FIXED PRODUCT FORM
        The block below replaces the broken form, quantity, and add-to-cart sections.
        {%- endcomment -%}

        {%- assign current_variant = product.selected_or_first_available_variant -%}
        {% form 'product', product, id: 'product-form-main', class: 'product-form' %}

          <!-- This hidden input stores the selected variant's ID -->
          <input type="hidden" name="id" value="{{ current_variant.id }}">
          
          <!-- Shop Pay Installments Banner -->
          <div class="hc-shop-pay-installments">
            {{ form | payment_terms }}
          </div>
        
          <!-- Variant Selector Dropdown -->
          <div class="prodMain__dropRow" {% if product.variants.size <= 1 %}style="display:none;"{% endif %}>
            <label class="prodMain__label text--15" for="variantDrop">
              Select Variant:
            </label>
            <select class="prodMain__select" id="variantDrop">
              {% for variant in product.variants %}
                <option 
                  value="{{ variant.id }}" 
                  {% if variant == current_variant %}selected="selected"{% endif %}
                  data-price="{{ variant.price | money }}"
                  data-compare-price="{{ variant.compare_at_price | money }}"
                >
                  {{ variant.title }}
                </option>
              {% endfor %}
            </select>
          </div>

          <div class="prodMain__buyRow">
            <!-- Quantity Selector -->
            <div class="prodMain__qtyWrapper">
              <label class="prodMain__label text--15" for="quantity-input">
                Qty
              </label>
              <div class="qtybox">
                <button type="button" class="btnqty qtyminus icon icon-minus">-</button>
                <input class="prodMain__qty text--15" type="number" min="1" id="quantity-input" name="quantity" value="1">
                <button type="button" class="btnqty qtyplus icon icon-plus">+</button>
              </div>
            </div>
            
            <!-- Add to Cart Button -->
            <button type="submit" name="add" class="prodMain__button button buyButton">
              Add To Cart
            </button>
          </div>

        {% endform %}
        
        {%- comment -%}
        END: FIXED PRODUCT FORM
        {%- endcomment -%}

        <div class="prodMain__dropRow" {% if product.variants.size == 1 %}style="display:none;"{% endif %}>
          <label class="prodMain__label text--15" for="variantDrop">
            Select Variant:
          </label>
          <select class="prodMain__select" id="variantDrop">
            {% for variant in product.variants %}
              <option value="{{ forloop.index0 }}" {% if forloop.first %}selected{% endif %}>{{ variant.title }}</option>
            {% endfor %}
          </select>
        </div>
        
        <div class="prodMain__buyRow__shipping">
          <div class="prodMain__buyRow__shipping__spacer"></div>
          <div class="prodMain__shippingText text--15">
            {{ section.settings.shippingText }}
          </div>
        </div>
        <div class="prodMain__checkGrid">
          {% for block in section.blocks %}
          {% if block.type == 'Check' %}
            <div class="prodMain__check">
              <img class="prodMain__checkImg lazyload"
              data-src="https://cdn.shopify.com/s/files/1/0441/3567/8105/files/check.png?v=1595616774"
              alt="check mark">
              <span class="prodMain__checkText text--14">
                {{ block.settings.text }}
              </span>
            </div>
          {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  window.addEventListener('load', () => {    
    const options2 = {
        fillContainer: true,
        offset: {vertical: 0, horizontal: 10}
    };
    const imghover = document.querySelectorAll('.zoom_image-container');
    const bodyclass = document.querySelector('body');
    imghover.forEach((img) => {
      img.addEventListener('mouseover', (event) => {
        bodyclass.classList.add("active_overflow");
      });
    })

    imghover.forEach((img) => {
      img.addEventListener('mouseleave', (event) => {
        bodyclass.classList.remove("active_overflow");
      });
    })
  
    
    new ImageZoom(document.querySelectorAll('.zoom_image-container')[0], options2);    

    document.querySelectorAll('.prodMain__lowerSlider .slick-slide').forEach((slide) => {
      slide.addEventListener('click', () => {
        setTimeout(() => {
          const selectedMain = document.querySelector('.prodMain__upperSlider .slick-slide.slick-active .zoom_image-container');
          new ImageZoom(selectedMain, options2);  
        },100);
      });
    })
  });
</script>

{% schema %}
{
 "name": "Product Top Section",
 "settings": [
  {
     "id": "productDescription",
     "type": "textarea",
     "label": "Product Description"
   },
   {
      "type": "checkbox",
      "id": "product_zoom_enable",
      "label": "zoom",
      "default": true
    },
   {
     "id": "backgroundColor",
     "type": "select",
     "label": "Background Color",
     "options": [
        { "value": "white", "label": "White" },
        { "value": "D1EEFF", "label": "Blue" }
     ]
   },
   {
     "id": "videoThumb",
     "type": "image_picker",
     "label": "Video Thumbnail"
   },
   {
     "id": "videoIframe",
     "type": "text",
     "label": "Video Iframe"
   },
   {
     "id": "reviewTitle",
     "type": "text",
     "label": "Featured Review Title"
   },
   {
     "id": "reviewText",
     "type": "textarea",
     "label": "Featured Review Text"
   },
   {
     "id": "reviewName",
     "type": "text",
     "label": "Featured Review Name"
   },
   {
     "id": "priceSavings",
     "type": "text",
     "label": "Price Savings"
   },
   {
     "id": "shippingText",
     "type": "text",
     "label": "Shipping Text"
   }
 ],
 "blocks":[
   {
     "type": "Check",
     "name": "Check",
     "settings":[
       {
         "id": "text",
         "type": "text",
         "label": "Text"
       }
     ]
   }
 ]
}
{% endschema %}

<style>
  .toZoom {
  border-radius: 5px;
  cursor: pointer;
  transition: 0.3s;
}

.toZoom:hover {opacity: 0.7;}

.modal {
  display: none; /* Hidden by default */
  position: absolute; /* Stay in place */
  z-index: 1; /* Sit on top */
  padding-top: 100px; /* Location of the box */
  left: 0;
  top: 0;
  width: 100%; /* Full width */
  height: 100%; /* Full height */
  overflow: auto; /* Enable scroll if needed */
  background-color: rgb(0,0,0); /* Fallback color */
  background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
}

/* Modal Content (image) */
.modal-content {
  margin: auto;
  display: block;
  width: 80%;
  max-width: 700px;
}

/* Add Animation */
.modal-content {  
  animation-name: zoom;
  animation-duration: 0.6s;
}

@keyframes zoom {
  from {transform: scale(0.1)} 
  to {transform: scale(1)}
}

/* The Close Button */
.close {
  position: absolute;
  top: 15px;
  right: 35px;
  color: #f1f1f1;
  font-size: 40px;
  font-weight: bold;
  transition: 0.3s;
}

.close:hover,
.close:focus {
  color: #bbb;
  text-decoration: none;
  cursor: pointer;
}

/* 100% Image Width on Smaller Screens */
@media only screen and (max-width: 700px){
  .modal-content {
    width: 100%;
  }
}
</style>
<script>
 

  
const modal = document.getElementsByClassName('idMyModal');
const img = document.getElementsByClassName('toZoom');
const modalImg = document.getElementsByClassName('modal-content');
for ( let i = 0; i < img.length; i++ ) {
  img[i].onclick = function () {
    modal[i].style.display = "block";
    modalImg[i].src = this.src;
  }
}

var span = document.getElementsByClassName("close");
for ( let i = 0; i < span.length; i++ ) {
  span[i].onclick = function() { 
    modal[i].style.display = "none";
  }
}
</script>

{%- comment -%}
START: ADDED SCRIPT FOR QUANTITY BUTTONS & VARIANT SELECTION
This script makes the quantity buttons and variant selector work correctly.
{%- endcomment -%}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // --- Quantity Button Logic ---
  const qtybox = document.querySelector('.qtybox');
  if (qtybox) {
    const minusBtn = qtybox.querySelector('.qtyminus');
    const plusBtn = qtybox.querySelector('.qtyplus');
    const quantityInput = qtybox.querySelector('#quantity-input');

    minusBtn.addEventListener('click', () => {
      let currentValue = parseInt(quantityInput.value, 10);
      if (currentValue > 1) {
        quantityInput.value = currentValue - 1;
      }
    });

    plusBtn.addEventListener('click', () => {
      let currentValue = parseInt(quantityInput.value, 10);
      quantityInput.value = currentValue + 1;
    });
  }

  // --- Variant Selector Logic ---
  const variantSelect = document.querySelector('#variantDrop');
  if (variantSelect) {
    const productForm = document.querySelector('#product-form-main');
    const hiddenVariantInput = productForm.querySelector('input[name="id"]');
    const priceElement = document.querySelector('#price');
    const comparePriceElement = document.querySelector('#compare');

    variantSelect.addEventListener('change', function() {
      const selectedOption = this.options[this.selectedIndex];
      
      // Update the hidden input that gets submitted to the cart
      if (hiddenVariantInput) {
        hiddenVariantInput.value = this.value;
      }
      
      // Update the displayed price
      if (priceElement && selectedOption.dataset.price) {
        priceElement.textContent = selectedOption.dataset.price;
      }
      
      // Update the displayed compare at price
      if (comparePriceElement && selectedOption.dataset.comparePrice) {
        const compareAtPriceValue = selectedOption.dataset.comparePrice.replace(/[^0-9.-]+/g,"");
        const priceValue = selectedOption.dataset.price.replace(/[^0-9.-]+/g,"");

        if (parseFloat(compareAtPriceValue) > parseFloat(priceValue)) {
            const savingsText = '{{ section.settings.priceSavings }}';
            let compareHtml = `<s>${selectedOption.dataset.comparePrice}</s>`;
            if (savingsText) {
              compareHtml += ` (${savingsText})`;
            }
            comparePriceElement.innerHTML = compareHtml;
            comparePriceElement.style.display = 'inline-block';
        } else {
            comparePriceElement.style.display = 'none';
        }
      } else {
         comparePriceElement.style.display = 'none';
      }
    });
  }
});

   jQuery(document).ready(function ($) {
	    $('[sm-accordion]').each(function () {
		    var thisThing = $(this);
		    thisThing.find('.faqAccordion-Title').on('click', function () {
			    var target = thisThing.find('.faqAccordion_container');

			    if (target.is(':visible')) {
				    target.slideUp();
				    $(this).find('span').removeClass('active');
			    } else {
				    target.slideDown();
				    $(this).find('span').addClass('active');
			    }
		    });
	    });
    })
</script>
 


